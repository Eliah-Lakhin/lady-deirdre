<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pretty Printer - The Lady Deirdre Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">2.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../lexis/lexis.html"><strong aria-hidden="true">3.</strong> Lexis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lexis/lexical-grammar.html"><strong aria-hidden="true">3.1.</strong> Lexical Grammar</a></li><li class="chapter-item expanded "><a href="../lexis/scanning-process.html"><strong aria-hidden="true">3.2.</strong> Scanning Process</a></li><li class="chapter-item expanded "><a href="../lexis/code-inspection.html"><strong aria-hidden="true">3.3.</strong> Code Inspection</a></li><li class="chapter-item expanded "><a href="../lexis/token-references.html"><strong aria-hidden="true">3.4.</strong> Token References</a></li><li class="chapter-item expanded "><a href="../lexis/site-references.html"><strong aria-hidden="true">3.5.</strong> Site References</a></li></ol></li><li class="chapter-item expanded "><a href="../syntax/syntax.html"><strong aria-hidden="true">4.</strong> Syntax</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax/syntax-grammar.html"><strong aria-hidden="true">4.1.</strong> Syntax Grammar</a></li><li class="chapter-item expanded "><a href="../syntax/error-recovering.html"><strong aria-hidden="true">4.2.</strong> Error Recovering</a></li><li class="chapter-item expanded "><a href="../syntax/debugging.html"><strong aria-hidden="true">4.3.</strong> Debugging</a></li><li class="chapter-item expanded "><a href="../syntax/syntax-tree.html"><strong aria-hidden="true">4.4.</strong> Syntax Tree</a></li><li class="chapter-item expanded "><a href="../syntax/node-references.html"><strong aria-hidden="true">4.5.</strong> Node References</a></li><li class="chapter-item expanded "><a href="../syntax/tree-inspection.html"><strong aria-hidden="true">4.6.</strong> Tree Inspection</a></li><li class="chapter-item expanded "><a href="../syntax/hand-written-parsers.html"><strong aria-hidden="true">4.7.</strong> Hand-Written Parsers</a></li><li class="chapter-item expanded "><a href="../syntax/overriding-a-parser.html"><strong aria-hidden="true">4.8.</strong> Overriding a Parser</a></li><li class="chapter-item expanded "><a href="../syntax/syntax-session.html"><strong aria-hidden="true">4.9.</strong> Syntax Session</a></li><li class="chapter-item expanded "><a href="../syntax/pratts-algorithm.html"><strong aria-hidden="true">4.10.</strong> Pratt's Algorithm</a></li></ol></li><li class="chapter-item expanded "><a href="../documents.html"><strong aria-hidden="true">5.</strong> Documents</a></li><li class="chapter-item expanded "><a href="../semantics/semantics.html"><strong aria-hidden="true">6.</strong> Semantics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../semantics/partition-into-scopes.html"><strong aria-hidden="true">6.1.</strong> Partition Into Scopes</a></li><li class="chapter-item expanded "><a href="../semantics/grammar-setup.html"><strong aria-hidden="true">6.2.</strong> Grammar Setup</a></li><li class="chapter-item expanded "><a href="../semantics/semantic-graph.html"><strong aria-hidden="true">6.3.</strong> Semantic Graph</a></li><li class="chapter-item expanded "><a href="../semantics/incremental-computations.html"><strong aria-hidden="true">6.4.</strong> Incremental Computations</a></li><li class="chapter-item expanded "><a href="../semantics/side-effects.html"><strong aria-hidden="true">6.5.</strong> Side Effects</a></li><li class="chapter-item expanded "><a href="../semantics/scope-access.html"><strong aria-hidden="true">6.6.</strong> Scope Access</a></li><li class="chapter-item expanded "><a href="../semantics/granularity.html"><strong aria-hidden="true">6.7.</strong> Granularity</a></li><li class="chapter-item expanded "><a href="../semantics/the-analyzer.html"><strong aria-hidden="true">6.8.</strong> The Analyzer</a></li><li class="chapter-item expanded "><a href="../semantics/tasks-management.html"><strong aria-hidden="true">6.9.</strong> Tasks Management</a></li><li class="chapter-item expanded "><a href="../semantics/multi-file-analysis.html"><strong aria-hidden="true">6.10.</strong> Multi-File Analysis</a></li><li class="chapter-item expanded "><a href="../semantics/language-server-design.html"><strong aria-hidden="true">6.11.</strong> Language Server Design</a></li><li class="chapter-item expanded "><a href="../semantics/configuration-issues.html"><strong aria-hidden="true">6.12.</strong> Configuration Issues</a></li><li class="chapter-item expanded "><a href="../semantics/code-diagnostics.html"><strong aria-hidden="true">6.13.</strong> Code Diagnostics</a></li><li class="chapter-item expanded "><a href="../semantics/tree-index.html"><strong aria-hidden="true">6.14.</strong> Tree Index</a></li></ol></li><li class="chapter-item expanded "><a href="../code-formatters/code-formatters.html"><strong aria-hidden="true">7.</strong> Code Formatters</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../code-formatters/pretty-printer.html" class="active"><strong aria-hidden="true">7.1.</strong> Pretty Printer</a></li></ol></li><li class="chapter-item expanded "><a href="../snippets.html"><strong aria-hidden="true">8.</strong> Snippets</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Lady Deirdre Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!------------------------------------------------------------------------------
  This file is part of "Lady Deirdre", a compiler front-end foundation
  technology.

  This work is proprietary software with source-available code.

  To copy, use, distribute, or contribute to this work, you must agree to
  the terms of the General License Agreement:

  https://github.com/Eliah-Lakhin/lady-deirdre/blob/master/EULA.md

  The agreement grants a Basic Commercial License, allowing you to use
  this work in non-commercial and limited commercial products with a total
  gross revenue cap. To remove this commercial limit for one of your
  products, you must acquire a Full Commercial License.

  If you contribute to the source code, documentation, or related materials,
  you must grant me an exclusive license to these contributions.
  Contributions are governed by the "Contributions" section of the General
  License Agreement.

  Copying the work in parts is strictly forbidden, except as permitted
  under the General License Agreement.

  If you do not or cannot agree to the terms of this Agreement,
  do not use this work.

  This work is provided "as is", without any warranties, express or implied,
  except where such disclaimers are legally invalid.

  Copyright (c) 2024 Ilya Lakhin (Илья Александрович Лахин).
  All rights reserved.
------------------------------------------------------------------------------->
<h1 id="pretty-printer"><a class="header" href="#pretty-printer">Pretty Printer</a></h1>
<p>The pretty printer object operates in a syntax-unaware manner, meaning it
doesn't consider the meaning of the original grammar tokens and nodes. Instead,
it deals with its own system of abstract tokens that shape the output in terms
of string words, blanks between words, and word groups only.</p>
<p>The objective of the printer is to interpret each incoming blank token as either
a whitespace or a line break, depending on the current line length and the
preconfigured maximum line length. If the printer determines to break the line
at the location of the blank token, it will subsequently indent or dedent the
following lines in accordance with the nesting of the groups.</p>
<h2 id="printing-words"><a class="header" href="#printing-words">Printing Words</a></h2>
<p>The <a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.word">PrettyPrinter::word</a>
function inputs a string word token into the printer, which will be printed on
the current line of the output, thus increasing the line length.</p>
<p>You invoke this function whenever encountering a parse tree token with content,
such as a keyword, identifier, or anything else besides whitespace or a line
break.</p>
<p>Additionally, you can call this function with a whitespace string to instruct
the printer to preserve the whitespace on the line regardless of the current
line length. This is useful, for instance, for comments' inner content or source
code string literals. However, it's not recommended to use this function to
forcibly break lines. In such cases, you should use the <em>hardbreak</em> function.</p>
<h2 id="blank-tokens"><a class="header" href="#blank-tokens">Blank Tokens</a></h2>
<p>To separate the words in the output of the printer, you utilize one of the
pretty printer's "blank" token functions:</p>
<ul>
<li>
<p><a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.blank">PrettyPrinter::blank</a>
is the default blank token, interpreted either as a single whitespace or a
line break. You call this function when the next word should be separated from
the previous one, possibly with a line break, depending on the printing
algorithm's decision.</p>
</li>
<li>
<p><a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.hardbreak">PrettyPrinter::hardbreak</a>
is a blank token that enforces the printer to always interpret it as a line
break. You call this function, for instance, when printing the inner content
of multi-line comments, as the structure of the comment's text typically needs
to be preserved.</p>
</li>
<li>
<p><a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.softbreak">PrettyPrinter::softbreak</a>
is similar to the <em>blank</em> function, but if the printer's algorithm decides to
preserve the next token on the line, it does not insert whitespace. This
function is useful, for example, to delimit the <code>.</code> dot tokens in a
call-chain (<code>foo.bar</code>). In such cases, you can insert a <em>softbreak</em> token
before the dot but omit the delimiter after the dot word</p>
</li>
</ul>
<h2 id="word-groups"><a class="header" href="#word-groups">Word Groups</a></h2>
<p>During the formatting process, when the current content exceeds the maximum line
length, the algorithm attempts to break the content into lines by interpreting
blank tokens as line breaks.</p>
<p>At this point, the algorithm can either interpret all blank tokens as line
breaks, resulting in consistent line splitting, or it can selectively interpret
some blank tokens, maximizing the utilization of line space.</p>
<p>Consistent line splitting is preferable for source code blocks, such as JSON
objects.</p>
<pre><code class="language-text">{
    "foo": 123,
    "bar": 456,
    "baz": 789
}
</code></pre>
<p>For enumerations of simple items (e.g., JSON arrays), inconsistent breaking is
more suitable.</p>
<pre><code class="language-text">[123, 456, 789, 1011, 1213, 1516, 1718, 1920, 2122,
    2324, 2526, 2728]
</code></pre>
<p>Content breaking occurs within word groups. To initiate a new group, you use
either <a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.cbox">PrettyPrinter::cbox</a>
or <a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.ibox">PrettyPrinter::ibox</a>.
The former
begins a consistent word group, while the latter starts an inconsistent group.</p>
<p>Each group must be closed by
calling <a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.end">PrettyPrinter::end</a>.</p>
<p>Both <em>cbox</em> and <em>ibox</em> functions accept indentation level shifting for the
group, represented by a signed integer. Positive values increase the inner
content's indentation, negative values decrease it (with zero having no effect).
When the printer breaks the content inside the group, each new line is indented
with whitespace according to the current indentation level.</p>
<h2 id="overriding-indentations"><a class="header" href="#overriding-indentations">Overriding Indentations</a></h2>
<p>You can manually adjust line indentation by calling
the <a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.indent">PrettyPrinter::indent</a>
function <strong>immediately after</strong> submitting any of the blank tokens. If the
algorithm interprets the submitted token as a line break, the next line, as well
as all subsequent lines, will be shifted accordingly.</p>
<h2 id="keeping-content-in-line"><a class="header" href="#keeping-content-in-line">Keeping Content In Line</a></h2>
<p>In general, the algorithm aims to break lines as early as possible so that
parental word groups are split by lines, while leaf groups remain in line.</p>
<pre><code class="language-text">{
    "foo": [123, 456, 789, 1011, 1213, 1516, 1718, 1920, 2122]
}
</code></pre>
<p>This approach is generally suitable for most practical use cases. However, there
are situations where it's preferable to keep the parental content aligned in
line and splitting of the nested groups instead.</p>
<p>In such cases, you can utilize
the <a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.neverbreak">PrettyPrinter::neverbreak</a>
function, which instructs the printer to reset the current line length counter
to zero. Consequently, the algorithm assumes that the previously submitted text
fits on the line, and begins splitting from the subsequent nested submissions.</p>
<pre><code class="language-text">{ "foo": [123, 456, 789, 1011, 1213, 1516, 1718,
    1920, 2122] }
</code></pre>
<h2 id="trailing-commas"><a class="header" href="#trailing-commas">Trailing Commas</a></h2>
<p>Depending on the language grammar, some languages allow leaving a trailing comma
at the end of lists (e.g., Rust and JavaScript, but not JSON). This ensures
better readability when the list is split into multiple lines, as the last item
receives a trailing comma, but the comma is omitted if the content remains in a
single line.</p>
<p>This formatting rule depends on whether the algorithm decides to insert a line
break at the blank token. To address this, you can use
the <a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.pre_break">PrettyPrinter::pre_break</a>
and <a href="https://docs.rs/lady-deirdre/2.2.0/lady_deirdre/format/struct.PrettyPrinter.html#method.pre_space">PrettyPrinter::pre_space</a>
functions to configure the preceding blank token.</p>
<p>Both functions must be called <strong>immediately after</strong> submitting the blank token.
The first function, <em>pre_break</em>, specifies a word that will be inserted before
the line break (at the end of the previous line), while the second function,
<em>pre_space</em>, inserts the specified word otherwise (the word will appear before
the whitespace when paired with the <em>blank</em> function).</p>
<p>When your program formats a comma-separated list, you can insert regular
<code>,</code> commas after each intermediary item and a normal blank token after each
comma. At the end of the list, after the last submitted item, you can submit a
<em>softbreak</em> token and configure it with <code>pre_break(',')</code>, ensuring that if this
trailing blank token receives a line break, the last line of the list will be
appended with a comma.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../code-formatters/code-formatters.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../snippets.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../code-formatters/code-formatters.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../snippets.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
